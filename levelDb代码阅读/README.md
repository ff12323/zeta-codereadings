

地址：https://github.com/google/leveldb/

文档地址：https://leveldb-handbook.readthedocs.io/zh/latest/index.html

```
neutral： not engaged on either side
```



## ch01 代码阅读的记录

阅读的问题：

- 对于一个不熟悉的领域，不熟悉的代码，应该如何阅读？如何做笔记呢？怎么样才算是高效的，有用的。
- C++：面向对象的代码，与面向过程的差别很大。
  - 1、通过对象的属性，使得函数的参数个数减小很多。可以通过对象的属性，进行通信，而不必大量依赖参数。

- 面向对象的代码阅读方法：
  - 1、以对象为主体（关注对象的设计，关注对象之间的组合，引用，依赖）
- 遗忘带来的问题：对于sstable的代码，由于总是忘记其设计的部分。导致无法理解代码，遇到阻塞。这类数据落盘的结构体设计，是一种至关重要的内存态数据（原始形态，分离） 《------》 磁盘态数据（持久化，合并，内存交换） 之间的中间转换部分。
  - levelDB代码中有很大的一部分，都是二者之间转换过程的代码实现（解码、编码、迭代、。。。其他功能）
- 设计与编写：
  - 1、一个复杂的功能，为何使用如此的方式进行组织、构建（具体将：为何是这些文件？为何如此命名？为何结构体、类是这样设计？）？
- 经验不足导致阅读缺陷：
  - 1、对于已有的简洁明了注释，经验不足，难以快速直接看懂。
  - 2、对于整体结构、基础功能、基础概念都很匮乏，需要花费时间与精力去记忆、认知这些隐性层面的内容。

- 经验丰富情况下的代码阅读优势：
  - 1、明晰整体的设计方案 与 具体细节，加上必要的基础，则可以很快上手项目代码，采用一些阅读方法与策略（自xxx而xxx），顺着主要流程与实现上而一路地阅读下来；再记录一个索引与思考，就能算得上是理解与掌握了。
  
- 阅读感想：第一次从头到尾，在代码实现层面上，**独自**地依靠文档 + 源码 + 笔记，完整地去阅读 一万多行 的 C++代码，有着一定程度的**复杂度**。这个过程中，花费了不少时间与困难，从设计上、概念上、应用技巧、设计技巧、编程规范与技巧、层级结构上、阅读方法与技巧 等等 很多方面都有了一定程度上的多方面、多角度的认知，绝对是自身学习编程道路上一个重要点，也让我意识到自身的薄弱与缺陷，何处是前进的方向？。
  - 认识到优秀的代码是怎么样设计与实现的。
  - 可以使自身的代码认知上升一个层级（万行），从而站在更宽阔的认知，见识到真实世界。也是进入下一层级的门槛；




代码风格的记录：

- 对于私有属性，在后缀加 `_`，而不是前缀 `_` 。1、是为了写更方便，避免前缀在输入的时候多输入字符。 2、在类方法中，可以直观地区分私有属性，方便阅读。
- 对于配置，枚举类型，全局变量等。 使用 格式`kXXX` ，k表示key？
- 接口类型：
  - 在公共的接口文件上，对文件设计、类本身、方法等内容有详细注释。而实现的地方，不带上这些注释。


想法的记录：

- 1、如果内存的空间无限大，并且带有持久化的特性。运行的软件，数据都在上面，这样key-value的DB，最简单且高性能的办法，只需要一个超大的多线程哈希表。
  - ❌：使用哈希，不是有序的，无法高效迭代DB。
- 阅读文档与阅读代码之间的差异：
  - 阅读文档时，没有相关经验。设计的原理、关键概念等讲解很详细，但是具体是如何的无法理解具体实现，感觉朦胧。
  - 阅读代码时，发现代码仓库很大，种类众多，文件零散，依赖复杂。陷入其中，难分主次轻重，更是迟迟无法发现设计、关键概念等。（细节繁多，原理层层）
  - 结论：二者之间交互进行，有助于互相促进。
- 浅谈外部视角 与 内部实现：
  - 从外部的角度看，这就是一个带有多种特性的kv数据库。对于使用者而言，只要调用接口，十分地简单明了。
  - 但是内部的设计，以及实现，总是牵涉到很多方面。1、各种中间的状态的转换，隐藏在内部。（阅读者想要升级为实现者，则不可避免地要完全地理解，由外而内的各种中间状态转变的流程，这个过程是复杂的）



阅读的问题记录：

1、阅读速度很慢，效率很低。需要思考下原因，想办法提升效率。

【算法类的代码】
例子：对于Varint的代码，使用很多的 位运算 + 循环。
现象： 阅读时，感觉非常艰难。耗时久，却无进展；是一个阻塞点。
解决：理解已有的文档讲解

【英文资料文档的问题】
例子：Varint的文档
现象：自己的英语水平依旧较差，对于稍微复杂的、专业化的英语，理解不到位。导致看这个文档迟迟无法完全理解。
解决：最后还是依靠中文讲解才能理解。

【经验问题】
缺乏经验，是效率低的基本原因

## ch02 levelDB的记录



遗忘概念的记录：

- 1、Restart point（重启点）：是sstable中data block结构里的一个组成部分。

核心概念：

- db类别：
  - **least-recently-used** eviction policy（LRU 缓存：最近最少使用 去除策略）
  - internal keys（内部key）： ？？？
    - 由  user key + 8bit 组成。
  - latency variance（时延方差，jitter 时延抖动）
  - 整合：Minor Compaction、Major Compaction
  - LSM树(Log Structured-Merge Tree)
  - 版本控制：
    - MVCC
- table类别：
  - 1、sstable（sorted table）、block（块）、data block（数据块）、restart point、filter block（过滤器块）、（元数据索引块）meta index block、（数据索引块）index block、footer（文件固定尾部）
    - compaction（整合）、dump、level 0层（L0）、level i 层（Li）
    - **prefix-compressed**（前缀压缩）
  - 2、memtable（内存表）、immutable memtable（不可变内存表）
  - 3、log(journal)（日志文件）
  - 4、manifest、current、version
  - others：
    - **delta encoding**（差分编码）
- util类别：
  - Endian-neutral encoding：这种编码方式的特点是它不依赖于特定的字节顺序，它可以在大端和小端字节顺序的系统之间进行转换。
  - "varint" encoding（varint编码）
  - Sharded LRU（分片LRU）
- C++语法：
  - opaque struct、Helper class（帮助类，如：mutex对象，构造时加锁，析构时解锁）
  - C++的柔性数组
- 数据结构：
  - Dummy head（假头，双向链表的第一个填充头部）、porting hacks（可移植技巧）





